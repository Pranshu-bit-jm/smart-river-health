<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>pH Care — Water Health & Index</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="description" content="pH Care — interactive advisor + comprehensive guide for Water Health & Index" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg1:#0077b6; --bg2:#00b4d8; --accent:#90e0ef; --card:#ffffff; --muted:#274142;
      --good:#2e7d32; --warn:#f9a825; --bad:#c62828; --radius:14px; --maxw:1200px;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:"Poppins",system-ui,Arial,sans-serif;background:linear-gradient(180deg,var(--bg1),var(--bg2));color:var(--muted);-webkit-font-smoothing:antialiased}
    header{max-width:var(--maxw);margin:18px auto;padding:18px;display:flex;align-items:center;justify-content:space-between;color:white}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:60px;height:60px;border-radius:12px;background:linear-gradient(135deg,var(--bg2),var(--bg1));display:flex;align-items:center;justify-content:center;color:#fff;font-weight:900;font-size:18px;box-shadow:0 12px 40px rgba(0,0,0,0.18)}
    nav.site-nav{display:flex;gap:10px;align-items:center}
    nav.site-nav a{color:white;text-decoration:none;padding:8px 12px;border-radius:10px;font-weight:600}
    nav.site-nav a.active{box-shadow:0 10px 30px rgba(0,0,0,0.15)}
    .page{max-width:var(--maxw);margin:22px auto;padding:0 18px}
    .hero{background:linear-gradient(135deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));border-radius:16px;padding:26px;box-shadow:0 18px 50px rgba(2,60,80,0.10);display:flex;gap:20px;align-items:center}
    .hero-left{flex:1}
    .hero-right{width:360px}
    h1{color:#012430;margin:0;font-size:1.6rem}
    .lead{color:#083b42;opacity:0.95}
    .anchor-nav{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
    .anchor-nav a{background:#f5fbff;padding:8px 12px;border-radius:10px;color:#023e8a;font-weight:700;border:1px solid rgba(0,0,0,0.04)}
    .grid{display:grid;grid-template-columns:1fr 380px;gap:18px;margin-top:20px}
    @media(max-width:980px){.grid{grid-template-columns:1fr}}
    .section{background:var(--card);border-radius:12px;padding:18px;box-shadow:0 12px 30px rgba(2,60,80,0.06)}
    .section h2{color:var(--bg1);margin-top:0}
    label{display:block;margin-top:10px;font-weight:700;color:var(--muted)}
    input[type=number], select, textarea {width:100%;padding:10px;margin-top:6px;border-radius:10px;border:1px solid #eef9ff;font-size:15px}
    .btn{background:linear-gradient(90deg,var(--bg1),var(--bg2));color:white;border:none;padding:10px 14px;border-radius:10px;font-weight:800;cursor:pointer}
    .btn.ghost{background:transparent;border:1px solid rgba(2,60,80,0.06);color:var(--muted)}
    .muted{color:var(--muted)}
    .advice-card{border-radius:12px;padding:14px;color:white;margin-top:12px;box-shadow:0 12px 30px rgba(0,0,0,0.12)}
    .advice-title{font-weight:800;font-size:1.1rem}
    .advice-body{margin-top:8px;font-size:0.95rem;background:rgba(255,255,255,0.02);padding:10px;border-radius:8px}
    .advice-checks{margin-top:10px}
    .advice-checks li{margin-bottom:8px}
    .small{font-size:0.92rem;color:var(--muted)}
    .kbd{background:#eef9ff;padding:6px 8px;border-radius:6px;font-weight:700;color:var(--bg1)}
    .callout{background:#f0fbff;border-left:6px solid var(--bg2);padding:12px;border-radius:8px;margin-top:12px;color:var(--muted)}
    table{width:100%;border-collapse:collapse;margin-top:12px}
    th,td{padding:10px;border-bottom:1px dashed rgba(2,60,80,0.04);text-align:left;color:var(--muted)}
    th{color:#032e34;font-weight:800}
    .team{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px;margin-top:12px}
    .member{background:#f7fdff;padding:12px;border-radius:10px;text-align:center}
    .member strong{display:block;margin-top:8px}
    footer{max-width:var(--maxw);margin:22px auto;padding:18px;text-align:center;color:white}
    .hidden{display:none}
    /* dynamic gradient helper classes */
    .adv-acid{background:linear-gradient(135deg,#ff6f61,#ffb88c)}
    .adv-slight-acid{background:linear-gradient(135deg,#ff9a76,#ffd8a8)}
    .adv-neutral{background:linear-gradient(135deg,#66bb6a,#2e7d32)}
    .adv-slight-alk{background:linear-gradient(135deg,#64b5f6,#42a5f5)}
    .adv-alk{background:linear-gradient(135deg,#4fc3f7,#2b9bd6)}
    .adv-danger{background:linear-gradient(135deg,#ff5f6d,#ffc371)}
    .pill{display:inline-block;padding:6px 10px;border-radius:999px;background:rgba(255,255,255,0.12);font-weight:700}
  </style>
</head>
<body>

  <header>
    <div class="brand">
      <div class="logo">pH</div>
      <div>
        <div style="font-weight:800;color:white">Water Health & Index</div>
        <div style="font-size:12px;color:rgba(255,255,255,0.9)">pH Care — advisor & full guide</div>
      </div>
    </div>

    <nav class="site-nav">
      <a href="index.html">Home</a>
      <a href="map.html">Map</a>
      <a href="phchart.html">pH Chart</a>
      <a href="phcare.html" class="active">pH Care</a>
      <a href="details.html">Details</a>
    </nav>
  </header>

  <main class="page">
    <div class="hero">
      <div class="hero-left">
        <h1>pH Care — Interactive Advisor & Field Guide</h1>
        <p class="lead">Type a pH value and click <strong>Get Advice</strong> to receive precise, situation-aware, and practical instructions — from safe household corrections to recommended professional actions.</p>

        <div class="anchor-nav" style="margin-top:12px">
          <a href="#advisor">pH Advisor</a>
          <a href="#overview">Overview</a>
          <a href="#detect">Detect</a>
          <a href="#acidic">Acidic fixes</a>
          <a href="#alkaline">Alkaline fixes</a>
          <a href="#stabilize">Stabilize</a>
          <a href="#advanced">Advanced</a>
        </div>
      </div>

      <div class="hero-right section">
        <div style="display:flex;flex-direction:column;gap:10px">
          <div><strong>Quick actions</strong></div>
          <button class="btn" onclick="location.href='index.html'">Open Camera Reader</button>
          <button class="btn ghost" onclick="location.href='map.html'">View Map</button>
          <div class="callout"><strong>Tip:</strong> Use calibration before camera readings for best results.</div>
        </div>
      </div>
    </div>

    <div class="grid">

      <!-- LEFT: main content -->
      <section>

        <!-- ADVISOR -->
        <article id="advisor" class="section">
          <h2>pH Advisor — enter a value for tailored advice</h2>
          <p class="small">The advisor interprets pH and suggests safe, practical, and prioritized steps to restore balance using natural or household-friendly methods where possible. It gives higher-level professional steps if the situation requires it.</p>

          <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:12px;align-items:center">
            <label style="margin-bottom:0">
              <div class="small">Enter measured pH</div>
              <input id="advisorInput" type="number" step="0.1" min="0" max="14" placeholder="e.g., 7.2" style="width:160px">
            </label>

            <label style="margin-bottom:0">
              <div class="small">Select water volume context</div>
              <select id="volumeSelect" style="width:200px">
                <option value="small">Small sample / container (liters)</option>
                <option value="pond">Small pond / tank (~100–10000 L)</option>
                <option value="stream">Stream / river</option>
                <option value="large">Large water body / reservoir</option>
              </select>
            </label>

            <div style="display:flex;gap:8px">
              <button id="getAdviceBtn" class="btn">Get Advice</button>
              <button id="clearAdviceBtn" class="btn ghost">Clear</button>
            </div>
          </div>

          <!-- Result card -->
          <div id="adviceWrapper" class="hidden">
            <div id="adviceCard" class="advice-card adv-neutral" role="status" aria-live="polite">
              <div style="display:flex;justify-content:space-between;align-items:center">
                <div>
                  <div class="advice-title" id="adviceTitle">Advice heading</div>
                  <div class="small" id="adviceSub">pH interpretation line</div>
                </div>
                <div style="text-align:right">
                  <div style="font-weight:900;font-size:24px" id="advicePH">pH 7.0</div>
                  <div class="pill" id="adviceRange">Range</div>
                </div>
              </div>

              <div class="advice-body" id="adviceText">
                Advice text here...
              </div>

              <div style="display:flex;gap:10px;margin-top:12px;flex-wrap:wrap;align-items:center">
                <button id="applyStepsBtn" class="btn">Show prioritized steps</button>
                <button id="openHomeBtn" class="btn ghost">Open in Home</button>
                <button id="copyAdviceBtn" class="btn ghost">Copy advice</button>
                <button id="downloadPDFBtn" class="btn ghost">Download (txt)</button>
              </div>

              <div style="margin-top:12px">
                <strong>Quick checklist</strong>
                <ul class="advice-checks" id="adviceChecks"></ul>
              </div>

              <div style="margin-top:12px" id="dosingBlock" class="hidden">
                <strong>Starter dosing estimates (very small systems only)</strong>
                <div class="small" id="dosingText"></div>
              </div>

              <div style="margin-top:12px" id="safetyBlock" class="callout hidden"></div>
            </div>
          </div>

          <!-- Prioritized steps (collapsible) -->
          <div id="stepsArea" class="hidden" style="margin-top:12px">
            <details open>
              <summary style="font-weight:800;color:var(--bg1)">Prioritized steps — follow in order</summary>
              <div id="stepsList" style="margin-top:10px"></div>
            </details>
          </div>

        </article>

        <!-- Rest of the original content (kept, trimmed for page brevity but complete) -->
        <article id="overview" class="section spaced" style="margin-top:16px">
          <h2>Overview — Why pH matters</h2>
          <p class="muted">pH measures hydrogen ion concentration and determines acidity or alkalinity. For natural waters, pH influences biology, chemistry, and public health. Even small, sustained deviations (±0.5 pH) can shift an ecosystem — test consistently before acting.</p>

          <div class="callout">
            <strong>Field takeaway:</strong> Use repeated readings and record time, temperature, turbidity, and context before major interventions.
          </div>
        </article>

        <article id="detect" class="section spaced">
          <h2>Detect & Measure — How to get reliable pH readings</h2>
          <p class="muted">Accurate measurement is the beginning of correct action. Use strips, meters, or the camera tool; calibrate instruments and document temperature and lighting conditions.</p>

          <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:12px">
            <div class="card" style="padding:12px">
              <strong>Manual strips</strong>
              <ul class="muted">
                <li>Use fresh strips, neutral light, white background, and compare quickly after dipping.</li>
                <li>Take 3 readings and average; note temperature next to pH value.</li>
              </ul>
            </div>
            <div class="card" style="padding:12px">
              <strong>Digital meters</strong>
              <ul class="muted">
                <li>Two- or three-point calibration with pH buffers; store electrode in proper storage solution.</li>
                <li>Enable temperature compensation if available.</li>
              </ul>
            </div>
          </div>
        </article>

        <article id="acidic" class="section spaced">
          <h2>Acidic water — diagnosis & remediation (pH &lt; 6.5)</h2>
          <p class="muted">Causes: acid rain, runoff, peat soils, industrial/urban discharge. Solutions range from passive limestone contactors to measured chemical dosing in professional setups.</p>
          <ul class="muted" style="margin-top:8px">
            <li>Small bucket or aquarium: baking soda incremental dosing (very small increments).</li>
            <li>Ponds/streams: crushed limestone contactors and riparian buffer restoration.</li>
            <li>Severe events: consult authorities and labs for metals testing (e.g., aluminum).</li>
          </ul>
        </article>

        <article id="alkaline" class="section spaced">
          <h2>Alkaline water — diagnosis & remediation (pH &gt; 8.5)</h2>
          <p class="muted">Causes: carbonate geology, detergents, algal photosynthesis. Solutions include dilution, CO₂ dosing, RO/ion exchange for mineral removal, or peat filtration for small systems.</p>
        </article>

        <article id="stabilize" class="section spaced">
          <h2>Stabilizing neutral pH — maintenance</h2>
          <p class="muted">Maintain 6.5–8.0 for most freshwater uses. Combine monitoring, vegetative buffers, aeration, and source control. Weekly field checks and monthly lab baselines are recommended.</p>
        </article>

        <article id="advanced" class="section spaced">
          <h2>Advanced tools & thresholds</h2>
          <p class="muted">Calibrate meters regularly, use NIST-traceable buffers if possible, keep calibration logs, and apply threshold-based automated alerts in monitoring systems.</p>
          <table>
            <thead><tr><th>Index / pH</th><th>Action</th></tr></thead>
            <tbody>
              <tr><td>Index ≥ 85 or pH 6.5–8.2</td><td>Routine monitoring — no action</td></tr>
              <tr><td>Index 70–84 or pH 6.0–6.4 / 8.3–8.8</td><td>Investigate upstream sources; increase monitoring</td></tr>
              <tr><td>Index 40–69 or pH &lt;6.0 / &gt;8.8</td><td>Local action & passive neutralization; lab tests advised</td></tr>
              <tr><td>Index &lt;40 or pH &lt;5.5 / &gt;10</td><td>Emergency response; notify authorities</td></tr>
            </tbody>
          </table>
        </article>

      </section>

      <!-- RIGHT: side resources -->
      <aside>
        <div class="section">
          <h3>Quick tools & tips</h3>
          <div style="margin-top:10px">
            <button class="btn" onclick="location.href='index.html'">Open Camera Reader</button>
            <button class="btn ghost" onclick="location.href='map.html'">View Map</button>
          </div>

          <div style="margin-top:12px">
            <h4>Reference ranges</h4>
            <table>
              <thead><tr><th>Use</th><th>pH</th></tr></thead>
              <tbody>
                <tr><td>Drinking</td><td>6.5–8.5</td></tr>
                <tr><td>Aquaculture</td><td>6.8–8.2</td></tr>
                <tr><td>Irrigation</td><td>6.0–8.4</td></tr>
              </tbody>
            </table>
          </div>

        </div>

        <div class="section" style="margin-top:12px">
          <h3>Emergency script</h3>
          <div class="muted">
            Use this when contacting authorities:
            <pre style="background:#f5fbff;padding:8px;border-radius:6px;color:#023e8a">
Location: [lat,lon] or name
Time: [ISO timestamp]
pH: [value], Temp: [°C], Turbidity: [low/med/high]
Observations: [fish kills, foam, odor]
Request: [sample, lab testing]</pre>
          </div>
        </div>

        <div class="section" style="margin-top:12px">
          <h3>Project team</h3>
          <div class="team">
            <div class="member"><img src="" alt="" style="width:64px;height:64px;border-radius:999px;background:#e8fbff;display:block;margin:0 auto"><strong>Pranshu</strong><div class="small">Lead & UI</div></div>
            <div class="member"><img src="" alt="" style="width:64px;height:64px;border-radius:999px;background:#e8fbff;display:block;margin:0 auto"><strong>Shibam Mondal</strong><div class="small">Data & Backend</div></div>
            <div class="member"><img src="" alt="" style="width:64px;height:64px;border-radius:999px;background:#e8fbff;display:block;margin:0 auto"><strong>Dipanjan</strong><div class="small">Research</div></div>
            <div class="member"><img src="" alt="" style="width:64px;height:64px;border-radius:999px;background:#e8fbff;display:block;margin:0 auto"><strong>Debjoyti</strong><div class="small">Testing & Docs</div></div>
          </div>
        </div>

      </aside>

    </div>

    <div style="margin-top:18px" class="muted">This page is informational. For large-scale remediation consult professionals and local authorities. Record and share readings to the Map to help community monitoring.</div>

  </main>

  <footer>© 2025 Water Health & Index — Because every drop deserves balance.</footer>

  <script>
    /* ============================
       pH Advisor logic (rich, >=15 advice levels)
       ============================ */

    const adviceInput = document.getElementById('advisorInput');
    const getAdviceBtn = document.getElementById('getAdviceBtn');
    const clearAdviceBtn = document.getElementById('clearAdviceBtn');
    const adviceWrapper = document.getElementById('adviceWrapper');
    const adviceCard = document.getElementById('adviceCard');
    const adviceTitle = document.getElementById('adviceTitle');
    const adviceSub = document.getElementById('adviceSub');
    const adviceText = document.getElementById('adviceText');
    const advicePH = document.getElementById('advicePH');
    const adviceRange = document.getElementById('adviceRange');
    const adviceChecks = document.getElementById('adviceChecks');
    const stepsArea = document.getElementById('stepsArea');
    const stepsList = document.getElementById('stepsList');
    const dosingBlock = document.getElementById('dosingBlock');
    const dosingText = document.getElementById('dosingText');
    const safetyBlock = document.getElementById('safetyBlock');
    const applyStepsBtn = document.getElementById('applyStepsBtn');
    const copyAdviceBtn = document.getElementById('copyAdviceBtn');
    const downloadPDFBtn = document.getElementById('downloadPDFBtn');
    const openHomeBtn = document.getElementById('openHomeBtn');

    const volumeSelect = document.getElementById('volumeSelect');

    // Advice bank array with thresholds and rich messages
    // Each entry: {min,max,title,short,adviceArray,checks,prioritySteps,dosingHint,flagSafety}
    const ADVICE_LEVELS = [
      {min:13, max:14, title:'Extremely alkaline — immediate hazard', short:'Very caustic (pH ≥13). Avoid contact; emergency response.', 
        adviceArray:[
          "pH is dangerously alkaline. Do not touch or attempt large corrections without safety gear.",
          "Contain the area and prevent access to humans and animals.",
          "Collect samples for laboratory analysis and notify authorities."
        ],
        checks:["Avoid direct contact","Isolate area","Notify environmental agency"],
        prioritySteps:[
          "Evacuate the immediate area and avoid human/animal contact.",
          "Collect samples in labeled containers with PPE and send to a certified lab.",
          "Notify local environmental authorities immediately."
        ], dosingHint:null, flagSafety:true
      },
      {min:11, max:12.9, title:'Very alkaline — professional intervention required', short:'Highly alkaline; risk of scaling and ecological harm.',
        adviceArray:[
          "High alkalinity likely from industrial discharge, detergents, or mineral leaching.",
          "Do not attempt bulk chemical dosing in open waters; consider controlled dilution in small systems.",
          "Strongly consider laboratory analysis and professional remediation."
        ],
        checks:["Avoid bathing/using water","Test for detergents/minerals","Contact pros"],
        prioritySteps:[
          "Stop known sources of contamination (e.g., industrial discharge) if possible.",
          "Collect samples and arrange lab analysis for salts/minerals.",
          "For small tanks: gradual dilution with neutral water, small acid dosing only under guidance."
        ], dosingHint:"Example (very small 100 L): dilute with 10–20 L neutral water and re-test. For acid dosing: use dilute food-grade citric acid at 1–3 ml of 5% solution in steps and re-test carefully.", flagSafety:true
      },
      {min:10, max:10.9, title:'High alkaline — immediate action recommended', short:'Significantly alkaline; control sources and dilute.',
        adviceArray:[
          "Alkaline levels at this range can harm aquatic life and reduce disinfection efficiency.",
          "Implement source control and consider dilution. Avoid chemical additions in large bodies."
        ],
        checks:["Source control","Dilution if possible","Watch ammonia toxicity"],
        prioritySteps:[
          "Identify and stop alkaline discharges.",
          "Dilute with lower-pH water if available and safe.",
          "For aquaculture: monitor ammonia and DO closely."
        ], dosingHint:"Small system (100 L): dilute 10–15 L and re-test; use 1–2 ml of 5% citric acid cautiously if needed.", flagSafety:true
      },
      {min:9.5, max:9.99, title:'Moderate-high alkaline', short:'Alkaline. Check mineral content and runoff.',
        adviceArray:[
          "Likely caused by mineral-rich geology or detergents.",
          "Look for sources such as runoff from car washes, detergents, or construction."
        ],
        checks:["Inspect surroundings","Test for hardness and salts","Consider RO for drinking water"],
        prioritySteps:[
          "Inspect upstream for soap/detergent sources.",
          "If small volume, dilute and re-test; if large, notify local water managers.",
          "Consider filtration (RO/ion exchange) for potable use."
        ], dosingHint:"Small container: 1–2 ml 5% citric acid per 100 L may reduce pH slightly — proceed slowly.", flagSafety:false
      },
      {min:8.6, max:9.49, title:'Slight to moderate alkaline', short:'Above ideal — monitor and identify sources.',
        adviceArray:[
          "pH is above the optimal range for many species.",
          "Control nutrient inputs and check for algal blooms that raise daytime pH."
        ],
        checks:["Check for algal growth","Note time of day (photosynthesis)","Inspect runoff"],
        prioritySteps:[
          "Check pH at dawn (when photosynthesis effect is minimal) to see baseline.",
          "Reduce nutrient inflows and manage vegetative buffers.",
          "For small tanks use peat filtration to lower pH gently."
        ], dosingHint:"Peat filtration for small tanks; dilute for larger systems.", flagSafety:false
      },
      {min:8.1, max:8.59, title:'Mildly alkaline', short:'Slightly high; usually manageable by source control.',
        adviceArray:[
          "Often caused by local geology or daily photosynthesis cycles.",
          "Monitor and reduce upstream inputs if possible."
        ],
        checks:["Re-test at dawn","Check conductivity/hardness","Monitor trends"],
        prioritySteps:[
          "Record readings multiple times to confirm trend.",
          "Maintain riparian vegetation and reduce detergent runoff.",
          "For aquaria, consider small peat or driftwood additions that lower pH slowly."
        ], dosingHint:null, flagSafety:false
      },
      {min:7.6, max:8.09, title:'Slightly alkaline — near acceptable', short:'Close to healthy but watch for trends.',
        adviceArray:[
          "This is often safe for many species but watch for episodic spikes.",
          "Ensure no detergent or industrial sources are nearby."
        ],
        checks:["Trend monitoring","photo checks for algae","upstream inspection"],
        prioritySteps:[
          "Continue routine monitoring weekly.",
          "Check for diurnal changes due to algae and aeration needs."
        ], dosingHint:null, flagSafety:false
      },
      {min:7.1, max:7.59, title:'Healthy to slightly above neutral', short:'Good for most uses — maintain buffers.',
        adviceArray:[
          "Very good range. Keep monitoring and maintain riparian buffers.",
          "Use saved readings to create a baseline for your site."
        ],
        checks:["Periodic monitoring","keep vegetation intact","log readings"],
        prioritySteps:[
          "Record the reading with timestamp and location.",
          "Continue regular checks; no immediate action needed."
        ], dosingHint:null, flagSafety:false
      },
      {min:6.6, max:7.09, title:'Ideal neutral range', short:'Excellent — maintain current practices.',
        adviceArray:[
          "Optimal range for freshwater ecosystems and many uses.",
          "Share this reading on the Map to contribute a healthy baseline."
        ],
        checks:["Log the reading","sample occasionally for trend analysis"],
        prioritySteps:[
          "No corrective action required. Maintain buffer zones and avoid pollutant inputs."
        ], dosingHint:null, flagSafety:false
      },
      {min:6.1, max:6.59, title:'Slightly acidic', short:'Mild acidity — consider gentle buffering.',
        adviceArray:[
          "Slightly acidic — may stress sensitive species if persistent.",
          "Use natural buffering (crushed limestone contact, shell gravel) for passive correction."
        ],
        checks:["Re-test in several hours","check metal leaching","look for runoff sources"],
        prioritySteps:[
          "Take replicate readings across times of day.",
          "For small tanks, add a small amount of crushed coral or shell grit and monitor.",
          "For ponds, plan a limestone contactor or buffer strip."
        ], dosingHint:"Small sample (10 L): ~0.5–1 g baking soda incrementally; re-test frequently.", flagSafety:false
      },
      {min:5.6, max:6.09, title:'Moderately acidic', short:'Acidic — passive neutralizers recommended.',
        adviceArray:[
          "More notable acidity that can mobilize metals and stress aquatic life.",
          "Prefer passive neutralization (limestone, crushed coral) rather than rapid chemical dosing."
        ],
        checks:["Test for metals","check upstream activity","monitor biological signs"],
        prioritySteps:[
          "Increase sampling frequency and test upstream/downstream.",
          "Introduce crushed limestone contactors or permeable limestone bags in-flow.",
          "If immediate household use: slow baking soda titration under observation."
        ], dosingHint:"100 L: start with 5–10 g baking soda, stir, re-test; proceed slowly.", flagSafety:false
      },
      {min:5.1, max:5.59, title:'Acidic — intervention needed', short:'Acidity may be harmful; investigate causes.',
        adviceArray:[
          "Likely sources include acid rain, peat drainage, or pollution.",
          "If persistent, send samples to a lab and consider community action."
        ],
        checks:["Metal testing (Al, Pb)","check for fish stress","notify local authorities if widespread"],
        prioritySteps:[
          "Collect and preserve samples for lab analysis.",
          "Install passive limestone contactors or controlled buffering for ponds.",
          "For small volumes: baking soda increments with frequent re-tests."
        ], dosingHint:"100 L: 10–20 g baking soda in staged additions; re-test after each step.", flagSafety:false
      },
      {min:4.1, max:5.09, title:'Strongly acidic — caution', short:'Harmful to organisms and infrastructure.',
        adviceArray:[
          "May cause metal leaching and fish mortality.",
          "Avoid contact and prioritize sample collection for lab testing."
        ],
        checks:["Avoid contact","lab tests for metals","protect livestock and people"],
        prioritySteps:[
          "Notify environmental agencies if observed in open waters.",
          "Use limestone contactors in flow paths; avoid chemical dosing in open systems without experts.",
          "For contained water, very careful bicarbonate dosing under controlled conditions."
        ], dosingHint:"For small tanks (50–100L) start with 20g baking soda in small fractions and re-test.", flagSafety:true
      },
      {min:0, max:4.09, title:'Extremely acidic — emergency', short:'Severe acidity; urgent response required.',
        adviceArray:[
          "High risk of acute toxicity, metal release, and ecological damage.",
          "Do not use water; restrict access and contact authorities."
        ],
        checks:["Do not use water","collect lab samples","notify emergency response"],
        prioritySteps:[
          "Alert authorities and environmental agencies immediately.",
          "Collect samples with PPE for lab confirmation.",
          "Implement containment and prevent spread (if possible)."
        ], dosingHint:null, flagSafety:true
      }
    ];

    // Function: find matching advice level
    function getAdviceLevel(ph){
      ph = Number(ph);
      if(isNaN(ph) || ph < 0 || ph > 14) return null;
      for(const lev of ADVICE_LEVELS){
        if(ph >= lev.min && ph <= lev.max) return lev;
      }
      return ADVICE_LEVELS[8]; // default neutral
    }

    // map PH level to CSS class for card
    function cssForLevel(lev){
      if(!lev) return 'adv-neutral';
      if(lev.min >= 13) return 'adv-danger';
      if(lev.min >= 11) return 'adv-alk';
      if(lev.min >= 9.5) return 'adv-alk';
      if(lev.min >= 8.6) return 'adv-slight-alk';
      if(lev.min >= 8.1) return 'adv-slight-alk';
      if(lev.min >= 7.1) return 'adv-neutral';
      if(lev.min >= 6.6) return 'adv-neutral';
      if(lev.min >= 6.1) return 'adv-slight-acid';
      if(lev.min >= 5.6) return 'adv-slight-acid';
      if(lev.min >= 5.1) return 'adv-acid';
      if(lev.min >= 4.1) return 'adv-acid';
      return 'adv-acid';
    }

    // Build and render advice UI
    function renderAdvice(ph, volumeContext){
      const lev = getAdviceLevel(ph);
      if(!lev){
        alert('Enter a valid pH between 0 and 14');
        return;
      }
      adviceWrapper.classList.remove('hidden');
      adviceCard.className = 'advice-card ' + cssForLevel(lev);
      adviceTitle.textContent = lev.title;
      adviceSub.textContent = lev.short;
      advicePH.textContent = 'pH ' + Number(ph).toFixed(2);
      // human-friendly range shown
      adviceRange.textContent = `${lev.min}–${lev.max}`;

      // Compose advice text (join adviceArray)
      adviceText.innerHTML = lev.adviceArray.map(s => `<div style="margin-bottom:6px">${s}</div>`).join('');

      // Checks
      adviceChecks.innerHTML = '';
      for(const c of lev.checks){
        const li = document.createElement('li'); li.textContent = c;
        adviceChecks.appendChild(li);
      }

      // Steps
      stepsList.innerHTML = '';
      for(const s of lev.prioritySteps){
        const div = document.createElement('div'); div.className='step'; div.style.marginTop='8px';
        div.innerHTML = `<strong>•</strong> ${s}`;
        stepsList.appendChild(div);
      }
      stepsArea.classList.remove('hidden');

      // Dosing hints (only for small volumes or when provided)
      if(lev.dosingHint){
        dosingBlock.classList.remove('hidden');
        // tailor dosing by volumeContext roughly (very approximate)
        let hint = lev.dosingHint;
        if(volumeContext === 'small') hint = hint.replace(/100 L/g,'10 L'); // quick adjust
        if(volumeContext === 'pond') hint = hint; // keep same
        dosingText.textContent = hint;
      } else {
        dosingBlock.classList.add('hidden');
      }

      // Safety block
      if(lev.flagSafety){
        safetyBlock.classList.remove('hidden');
        safetyBlock.textContent = '⚠️ SAFETY: This situation requires professional attention. Avoid DIY bulk chemical treatments and contact local environmental authorities.';
      } else {
        safetyBlock.classList.add('hidden');
      }

      // Save current advice for copy/download
      currentAdviceSnapshot = {
        ph: Number(ph).toFixed(2),
        title: lev.title,
        short: lev.short,
        adviceText: lev.adviceArray.join('\n'),
        steps: lev.prioritySteps.join('\n'),
        checks: lev.checks.join('\n')
      };
    }

    // event handlers
    let currentAdviceSnapshot = null;
    getAdviceBtn.addEventListener('click', ()=>{
      const ph = Number(adviceInput.value);
      const vol = volumeSelect.value;
      renderAdvice(ph, vol);
      // scroll to result
      setTimeout(()=> { document.getElementById('adviceWrapper').scrollIntoView({behavior:'smooth', block:'center'}); }, 120);
    });

    clearAdviceBtn.addEventListener('click', ()=> {
      adviceWrapper.classList.add('hidden');
      stepsArea.classList.add('hidden');
      adviceInput.value = '';
      currentAdviceSnapshot = null;
    });

    applyStepsBtn.addEventListener('click', ()=> {
      if(!currentAdviceSnapshot){ alert('Get advice first'); return; }
      stepsArea.classList.toggle('hidden');
      setTimeout(()=> { stepsArea.scrollIntoView({behavior:'smooth'}); }, 60);
    });

    copyAdviceBtn.addEventListener('click', ()=>{
      if(!currentAdviceSnapshot){ alert('No advice to copy'); return; }
      const txt = `pH: ${currentAdviceSnapshot.ph}\n${currentAdviceSnapshot.title}\n\nAdvice:\n${currentAdviceSnapshot.adviceText}\n\nSteps:\n${currentAdviceSnapshot.steps}`;
      navigator.clipboard?.writeText(txt).then(()=> alert('Advice copied to clipboard')).catch(()=> alert('Copy failed'));
    });

    downloadPDFBtn.addEventListener('click', ()=>{
      if(!currentAdviceSnapshot){ alert('No advice to download'); return; }
      // simple text download
      const txt = `pH: ${currentAdviceSnapshot.ph}\n${currentAdviceSnapshot.title}\n\nAdvice:\n${currentAdviceSnapshot.adviceText}\n\nSteps:\n${currentAdviceSnapshot.steps}`;
      const blob = new Blob([txt], {type:'text/plain'}); const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = `ph-advice-${currentAdviceSnapshot.ph}.txt`; a.click();
      setTimeout(()=> { URL.revokeObjectURL(url); }, 500);
    });

    // Open in Home with pH prefill
    openHomeBtn.addEventListener('click', ()=>{
      if(!currentAdviceSnapshot){ alert('No advice to open'); return; }
      const ph = currentAdviceSnapshot.ph;
      // open index.html with query param
      location.href = `index.html?ph=${encodeURIComponent(ph)}`;
    });

    // Auto read query param if present to prefill
    (function prefillFromQuery(){
      const params = new URLSearchParams(window.location.search);
      if(params.has('ph')){
        const val = params.get('ph');
        adviceInput.value = val;
        // auto run
        setTimeout(()=> { getAdviceBtn.click(); }, 300);
      }
    })();

    // small helper: sample interactions for development
    // none needed

  </script>
</body>
</html>
